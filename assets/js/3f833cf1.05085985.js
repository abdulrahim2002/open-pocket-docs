"use strict";(self.webpackChunkmy_docs=self.webpackChunkmy_docs||[]).push([[2086],{8453:(e,s,n)=>{n.d(s,{R:()=>a,x:()=>l});var t=n(6540);const r={},i=t.createContext(r);function a(e){const s=t.useContext(i);return t.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function l(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:a(e.components),t.createElement(i.Provider,{value:s},e.children)}},9545:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>o,contentTitle:()=>l,default:()=>h,frontMatter:()=>a,metadata:()=>t,toc:()=>d});const t=JSON.parse('{"id":"Processes/send_request_lifecycle","title":"Lifecycle of a send request","description":"With the send endpoint, the user only needs to supply consumer_key and","source":"@site/docs/Processes/send_request_lifecycle.md","sourceDirName":"Processes","slug":"/Processes/send_request_lifecycle","permalink":"/open-pocket-docs/docs/Processes/send_request_lifecycle","draft":false,"unlisted":false,"editUrl":"https://github.com/abdulrahim2002/open-pocket-backend-server/tree/docs/docs/Processes/send_request_lifecycle.md","tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"title":"Lifecycle of a send request","sidebar_position":3},"sidebar":"tutorialSidebar","previous":{"title":"add request lifecycle","permalink":"/open-pocket-docs/docs/Processes/add_request_lifecycle"}}');var r=n(4848),i=n(8453);const a={title:"Lifecycle of a send request",sidebar_position:3},l="Lifecycle of a /send request",o={},d=[{value:"Retrieval:",id:"retrieval",level:3}];function c(e){const s={code:"code",h1:"h1",h3:"h3",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",...(0,i.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(s.header,{children:(0,r.jsx)(s.h1,{id:"lifecycle-of-a-send-request",children:"Lifecycle of a /send request"})}),"\n",(0,r.jsxs)(s.p,{children:["With the send endpoint, the user only needs to supply ",(0,r.jsx)(s.code,{children:"consumer_key"})," and\n",(0,r.jsx)(s.code,{children:"access_token"}),". And the app should automatically return all the items\nthat belong to that user."]}),"\n",(0,r.jsx)(s.p,{children:"Optional filteres can be added, but for the sake of simplicity, we will\ndeal with them later."}),"\n",(0,r.jsxs)(s.ol,{children:["\n",(0,r.jsx)(s.li,{children:"consumer_key"}),"\n",(0,r.jsx)(s.li,{children:"access_token"}),"\n"]}),"\n",(0,r.jsxs)(s.p,{children:["Now we cannot do anything with ",(0,r.jsx)(s.code,{children:"consumer_key"})," yet."]}),"\n",(0,r.jsx)(s.p,{children:"Let us take a careful look at what are the response fields that need to\nbe returned."}),"\n",(0,r.jsx)(s.p,{children:"From the database's perspective, only the following fields are"}),"\n",(0,r.jsx)(s.p,{children:"important:"}),"\n",(0,r.jsxs)(s.ol,{children:["\n",(0,r.jsx)(s.li,{children:"url"}),"\n",(0,r.jsx)(s.li,{children:"title"}),"\n",(0,r.jsx)(s.li,{children:"tags"}),"\n",(0,r.jsx)(s.li,{children:"user_id (generated through access token)"}),"\n"]}),"\n",(0,r.jsx)(s.p,{children:"We need to perform the following operations:"}),"\n",(0,r.jsxs)(s.ol,{children:["\n",(0,r.jsxs)(s.li,{children:["add article into the ",(0,r.jsx)(s.code,{children:"articles"})," table"]}),"\n",(0,r.jsxs)(s.li,{children:["add all the tags provided into the ",(0,r.jsx)(s.code,{children:"tags"})," table (with item_id and\nuser_id set)"]}),"\n"]}),"\n",(0,r.jsx)(s.p,{children:"Let us try to simulate a sample request. Firstly, we need a user. Let's\ninsert a sample one:"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-sql",children:"INSERT INTO users (provider, \"name\", \"email\", \"hashed_password\") \nVALUES ('ok','abdul1','abdul1@mail.com','112fewfi3n123oi34');\n"})}),"\n",(0,r.jsxs)(s.p,{children:["Now, we use the parameters we obtained from the ",(0,r.jsx)(s.code,{children:"add"})," request along with\nparser/backend processing, to retrieve all relevant fields we need to\nstore the ",(0,r.jsx)(s.code,{children:"article"})," in ",(0,r.jsx)(s.code,{children:"articles"})," table. We have the following data:"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-sql",children:"INSERT INTO articles (\n    user_id, status, favorite, resolved_title, \n    resolved_url, excerpt, is_article, is_index, \n    has_video, has_image, word_count, top_image_url, \n    author_id\n) \nVALUES (\n    17, 0, false, 'Title 1', 'https://abdulrahim.space/', \n    'a little excerpt', true, false, 0, 0, 123, \n    'https://topimage.com/topimage.png', 1\n);\n"})}),"\n",(0,r.jsxs)(s.p,{children:["Suppose we have 2 tags for this article: ",(0,r.jsx)(s.code,{children:"fantasy"}),", ",(0,r.jsx)(s.code,{children:"novel"})]}),"\n",(0,r.jsx)(s.p,{children:"We then insert these into the tags table."}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-sql",children:"INSERT INTO tags (user_id, item_id, tag_name) VALUES (17, 8, 'fantasy');\nINSERT INTO tags (user_id, item_id, tag_name) VALUES (17, 8, 'horror');\n"})}),"\n",(0,r.jsx)(s.p,{children:"And we are done. Now we have all the data we need."}),"\n",(0,r.jsx)(s.hr,{}),"\n",(0,r.jsx)(s.h3,{id:"retrieval",children:"Retrieval:"}),"\n",(0,r.jsx)(s.p,{children:"Now let's imagine what can we do with this data. The most simple use\ncase is, return few articles that belong to a particular user, to show\nit on the homepage. The tags should also appear with each article. This\ncan be done simply by the following query:"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-sql",children:"SELECT a.item_id, a.user_id, a.resolved_url, ARRAY_AGG(t.tag_name) \nFROM    articles a \n            LEFT JOIN \n        tags t \nON  a.item_id  = t.item_id \n        AND \n    a.user_id = t.user_id \nWHERE a.user_id=17\nGROUP BY a.item_id, a.user_id;\n"})}),"\n",(0,r.jsxs)(s.p,{children:["Which provides us with all the articles belonging to ",(0,r.jsx)(s.code,{children:"user_id=17"}),". And\naggregating their tags."]}),"\n",(0,r.jsx)(s.p,{children:"Hence, a setup like this can easily be used to get articles to show on\nthe home page of the user."}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-sql",children:" item_id | user_id |       resolved_url        |    array_agg     \n---------+---------+---------------------------+------------------\n       7 |      17 |                           | {NULL}\n       8 |      17 | https://abdulrahim.space/ | {fantasy,horror}\n(2 rows)\n"})})]})}function h(e={}){const{wrapper:s}={...(0,i.R)(),...e.components};return s?(0,r.jsx)(s,{...e,children:(0,r.jsx)(c,{...e})}):c(e)}}}]);