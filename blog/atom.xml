<?xml version="1.0" encoding="utf-8"?><?xml-stylesheet type="text/xsl" href="atom.xsl"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <id>https://abdulrahim2002.github.io/open-pocket-docs/blog/</id>
    <title>Open Pocket Blog</title>
    <updated>2025-09-08T18:15:22.000Z</updated>
    <generator>https://github.com/jpmonette/feed</generator>
    <link rel="alternate" href="https://abdulrahim2002.github.io/open-pocket-docs/blog/"/>
    <subtitle>Open Pocket Blog</subtitle>
    <icon>https://abdulrahim2002.github.io/open-pocket-docs/img/favicon.ico</icon>
    <entry>
        <title type="html"><![CDATA[Why secure cookies can pass through load balancer]]></title>
        <id>https://abdulrahim2002.github.io/open-pocket-docs/blog/why-secure-cookies-can-pass-through-load-balancer/</id>
        <link href="https://abdulrahim2002.github.io/open-pocket-docs/blog/why-secure-cookies-can-pass-through-load-balancer/"/>
        <updated>2025-09-08T18:15:22.000Z</updated>
        <summary type="html"><![CDATA[how encrypted cookies are forwarded from load balancer to the client]]></summary>
        <content type="html"><![CDATA[<h2 class="anchor anchorWithStickyNavbar_LWe7" id="how-encrypted-cookies-are-forwarded-from-load-balancer-to-the-client">how encrypted cookies are forwarded from load balancer to the client<a href="https://abdulrahim2002.github.io/open-pocket-docs/blog/why-secure-cookies-can-pass-through-load-balancer/#how-encrypted-cookies-are-forwarded-from-load-balancer-to-the-client" class="hash-link" aria-label="Direct link to how encrypted cookies are forwarded from load balancer to the client" title="Direct link to how encrypted cookies are forwarded from load balancer to the client">​</a></h2>
<p>with the proper configuration, cookies marked with Secure=true can be
successfully transmitted and processed by your backend instances even
when SSL is terminated at the load balancer.  How This Works</p>
<p>The key is that the Secure flag is about the client's connection, not
the backend connection:</p>
<p>Browser to Load Balancer: The client's browser only sends the Secure
cookie over HTTPS to your load balancer</p>
<p>Load Balancer to Backend: The load balancer terminates SSL, then
forwards the request (including the cookie) to your backend over HTTP</p>
<p>Backend Processing: Your Fastify application, configured with
trustProxy: true, recognizes that the original request was secure (via
the X-Forwarded-Proto: https header) and properly handles the secure
cookie</p>
<p>Visualizing the Flow</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Client (HTTPS) → Load Balancer (SSL termination) → Backend (HTTP)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    │                       │                         │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    │-- Secure cookie -----&gt;│                         │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    │                       │-- Same cookie ---------&gt;│</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    │                       │ (with X-Forwarded-Proto)│</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    │                       │                         │&lt;- Fastify sees</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    │                       │                         │   X-Forwarded-Proto: https</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    │                       │                         │   and treats cookie as secure</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<p>Why This Is Secure</p>
<p>The browser only transmits the cookie over HTTPS to your load balancer</p>
<p>The internal network between your load balancer and backend is typically trusted and secured</p>
<p>Your backend validates that the original request was secure using the X-Forwarded-Proto header</p>
<p>Step 1: The Client Makes a Secure Request</p>
<p>The user's browser makes a request to <a href="https://yourapp.com/" target="_blank" rel="noopener noreferrer">https://yourapp.com</a>.</p>
<p>Because the cookie is set with Secure=true, the browser's internal logic says: "Only attach this cookie to requests that use the https:// protocol."</p>
<p>The browser sends a request that includes the Cookie header to your load balancer over a secure HTTPS connection.</p>
<p>Request Headers (to Load Balancer):
text</p>
<p>GET / HTTP/1.1
Host: yourapp.com
Cookie: your_secure_session_cookie=encrypted_data_here
...other headers...</p>
<p>Step 2: The Load Balancer Terminates SSL</p>
<p>The load balancer receives the encrypted HTTPS request.</p>
<p>It performs SSL/TLS termination: it decrypts the request to inspect and process it (e.g., for routing, health checks, etc.).</p>
<p>Crucially, the decrypted HTTP request still contains the original Cookie header. The act of decryption does not remove it.</p>
<p>Step 3: The Load Balancer Forwards the Request &amp; Adds Metadata</p>
<p>The load balancer now needs to forward this decrypted HTTP request to one of your backend Fastify instances.</p>
<p>Before sending it, the load balancer adds standard HTTP headers to inform the backend about the original nature of the client's request. The most important one is X-Forwarded-Proto.</p>
<p>The load balancer forwards the complete, original HTTP request (including the Cookie header) and simply appends these new headers.</p>
<p>Request Headers (from Load Balancer to Backend):
text</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">GET / HTTP/1.1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Host: internal-backend-address</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Cookie: your_secure_session_cookie=encrypted_data_here</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">X-Forwarded-Proto: https   # &lt;- The most important header</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">X-Forwarded-For: 123.123.123.123 # &lt;- The client's original IP</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">X-Forwarded-Port: 443            # &lt;- The original port</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...other headers...</span><br></span></code></pre></div></div>
<p>Note: The Cookie header is passed through completely unchanged. The backend instance receives it exactly as the browser sent it.
Step 4: The Backend (Fastify) Interprets the Request</p>
<p>Your Fastify server receives the request from the load balancer. By default, it would see a plain HTTP request and think, "This is an insecure connection."</p>
<p>However, because you configured Fastify with trustProxy: true, it knows to look for the X-Forwarded-* headers to understand the true nature of the request.</p>
<p>Fastify sees X-Forwarded-Proto: https and essentially says, "Ah, even though this connection to me is HTTP, the original request from the client was HTTPS. I will therefore treat this as if it were a secure HTTPS request."</p>
<p>Step 5: Fastify-Secure-Session Makes Its Decision</p>
<p>The fastify-secure-session plugin is asked to read the cookie.</p>
<p>Because Fastify is now treating the request as secure (due to X-Forwarded-Proto), when the plugin checks request.secure or the protocol, it gets a true value.</p>
<p>Since you configured it with secure: 'auto', it validates that the environment is "secure" and happily processes the Secure cookie. It would reject the cookie if X-Forwarded-Proto was http</p>
<p>this rule is enforced solely by the browser (the client). The load balancer is free to send the cookie over HTTP to your backend because it is not a browser and does not follow the same security rules.
Detailed Breakdown</p>
<ol>
<li>Rule Enforcement: The Browser's Job</li>
</ol>
<p>The statement "a Secure=true cookie shall not be sent over HTTP" is a security policy enforced by the web browser (Chrome, Firefox, Safari, etc.).</p>
<p>How it works: When a website sets a cookie with the Secure attribute, the browser stores it and marks it as "only sendable over secure channels."</p>
<p>Before sending a request: The browser checks the protocol of the URL it's about to call.</p>
<p>If the URL starts with https://, the browser attaches all relevant cookies, including those marked Secure.</p>
<p>If the URL starts with http://, the browser will not attach any cookies marked Secure. This is the enforcement.</p>
<p>This is a critical client-side security feature designed to prevent accidental leakage of sensitive cookies over unencrypted networks.
2. The Load Balancer's Role: It's a Server, Not a Client</p>
<p>The load balancer operates completely differently. It is a server-side component that receives requests and forwards them.</p>
<p>It receives the client's HTTPS request, which includes the Secure cookie (because the browser correctly sent it over HTTPS).</p>
<p>It terminates SSL, decrypting the request. The decrypted request now exists in memory on the load balancer as plain HTTP, but it still contains the original Cookie header with the secure cookie.</p>
<p>It forwards this entire HTTP request (headers, body, and the Cookie header) to the backend server.</p>
<p>The load balancer does not care about the Secure attribute. Its job is to faithfully forward the request it received. The Secure attribute is a instruction for the browser, not for intermediaries like load balancers.
Visualization of the Flow</p>
<p>Why This is Still Secure</p>
<p>This architecture is considered secure because the trust boundary is between the client and the load balancer. The network between the load balancer and your backend instances is considered a trusted, private network (e.g., within a secure cloud VPC or data center). The security of that internal network is managed by you/your cloud provider, not by the public-facing rules of web browsers.</p>
<p>The X-Forwarded-Proto header allows your backend to reconstruct the client's experience and apply logic (like cookie security) appropriately, even on the trusted internal network.</p>]]></content>
        <author>
            <name>Open Pocket Team</name>
        </author>
        <category label="OpenPocket" term="OpenPocket"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Genesis]]></title>
        <id>https://abdulrahim2002.github.io/open-pocket-docs/blog/genesis/</id>
        <link href="https://abdulrahim2002.github.io/open-pocket-docs/blog/genesis/"/>
        <updated>2025-08-16T14:32:16.000Z</updated>
        <summary type="html"><![CDATA[Update: Pocket is shutting down on July 8, 2025]]></summary>
        <content type="html"><![CDATA[<h2 class="anchor anchorWithStickyNavbar_LWe7" id="update-pocket-is-shutting-down-on-july-8-2025">Update: Pocket is shutting down on July 8, 2025<a href="https://abdulrahim2002.github.io/open-pocket-docs/blog/genesis/#update-pocket-is-shutting-down-on-july-8-2025" class="hash-link" aria-label="Direct link to Update: Pocket is shutting down on July 8, 2025" title="Direct link to Update: Pocket is shutting down on July 8, 2025">​</a></h2>
<p><a href="https://support.mozilla.org/en-US/kb/future-of-pocket" target="_blank" rel="noopener noreferrer">Pocket is Saying Goodbye: What You Need to Know</a></p>
<p>There is no mention if any other part of the codebase will be open-sourced.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="recent-discussions">Recent Discussions<a href="https://abdulrahim2002.github.io/open-pocket-docs/blog/genesis/#recent-discussions" class="hash-link" aria-label="Direct link to Recent Discussions" title="Direct link to Recent Discussions">​</a></h2>
<p><a href="https://news.ycombinator.com/item?id=44597668" target="_blank" rel="noopener noreferrer">Ask HN: What Pocket alternatives did you move to?</a></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="background">Background<a href="https://abdulrahim2002.github.io/open-pocket-docs/blog/genesis/#background" class="hash-link" aria-label="Direct link to Background" title="Direct link to Background">​</a></h2>
<p><a href="https://en.wikipedia.org/wiki/Pocket_(service)" target="_blank" rel="noopener noreferrer">Pocket</a>, previously known as Read It Later, is an application and web service for managing a reading list of articles and videos from the Internet.</p>
<p>In February 2017, Mozilla <a href="https://blog.mozilla.org/blog/2017/02/27/mozilla-acquires-pocket/" target="_blank" rel="noopener noreferrer">acquired Pocket</a> and stated that Pocket "will become part of the Mozilla open source project".</p>
<p>A <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1343006" target="_blank" rel="noopener noreferrer">ticket</a> to open source the code was opened the same day, but closed in 2018.</p>
<p>It's now over six years since that promise, and although some code has been shared on <a href="https://github.com/Pocket" target="_blank" rel="noopener noreferrer">https://github.com/Pocket</a>, the majority remains closed, including the core server and client applications.</p>
<p>There have been <a href="https://discourse.mozilla.org/t/pocket-source-code/43686/7" target="_blank" rel="noopener noreferrer">continued requests</a> for Mozilla to open source the code. The most recent public responses on this, from Pocket CEO <a href="https://twitter.com/mkoidin?lang=en" target="_blank" rel="noopener noreferrer">Matt Koidon</a>, were:</p>
<ul>
<li><a href="https://discourse.mozilla.org/t/pocket-source-code/43686/7" target="_blank" rel="noopener noreferrer">https://discourse.mozilla.org/t/pocket-source-code/43686/7</a> (June 2020)</li>
<li><a href="https://github.com/Pocket/extension-save-to-pocket/issues/75" target="_blank" rel="noopener noreferrer">https://github.com/Pocket/extension-save-to-pocket/issues/75</a> (July 2020)</li>
</ul>
<p>The issues raised are valid. Open-sourcing a previously private codebase has many challenges.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="the-open-pocket-mission">The Open Pocket Mission<a href="https://abdulrahim2002.github.io/open-pocket-docs/blog/genesis/#the-open-pocket-mission" class="hash-link" aria-label="Direct link to The Open Pocket Mission" title="Direct link to The Open Pocket Mission">​</a></h2>
<p>Pocket is a great app and ecosystem, but its future success isn't guaranteed.</p>
<p>In 2020, Mozilla had <a href="https://arstechnica.com/information-technology/2020/08/firefox-maker-mozilla-lays-off-250-workers-says-covid-19-lowered-revenue/" target="_blank" rel="noopener noreferrer">large lay-offs</a>. Although these didn't appear to impact Pocket, it does raise questions about Mozilla's financial health.</p>
<p>The purpose of the Open Pocket organization is to gather those who are interested in building a '<a href="https://en.wikipedia.org/wiki/Clean_room_design" target="_blank" rel="noopener noreferrer">clean room</a>' open-source implementation of Pocket comprising of:</p>
<ul>
<li>A web site replicating the behavior of <a href="https://getpocket.com/" target="_blank" rel="noopener noreferrer">https://getpocket.com/</a></li>
<li>An API compatible with the current (<a href="https://getpocket.com/developer/docs/v3/retrieve" target="_blank" rel="noopener noreferrer">v3</a>) Pocket API.</li>
<li>Clients such as an iOS and Android app</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="how-to-help">How to Help<a href="https://abdulrahim2002.github.io/open-pocket-docs/blog/genesis/#how-to-help" class="hash-link" aria-label="Direct link to How to Help" title="Direct link to How to Help">​</a></h2>
<ul>
<li>Star and Watch this repo to follow the latest updates.</li>
<li>If you have thoughts on how to help build Open Pocket, create an <a href="https://github.com/open-pocket/open-pocket/issues" target="_blank" rel="noopener noreferrer">issue</a> or <a href="https://github.com/open-pocket/open-pocket/discussions" target="_blank" rel="noopener noreferrer">discussion topic</a> to help find others to work with.</li>
<li>If you've already started building something, consider joining forces with the Open Pocket organization.</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="available-projects">Available Projects<a href="https://abdulrahim2002.github.io/open-pocket-docs/blog/genesis/#available-projects" class="hash-link" aria-label="Direct link to Available Projects" title="Direct link to Available Projects">​</a></h2>
<p>The following projects have already been open-sourced. (This list excludes infrastructure projects, and those not updated in the past 5 years).</p>
<ul>
<li><a href="https://github.com/mozmeao/pocket-marketing-pages" target="_blank" rel="noopener noreferrer">https://github.com/mozmeao/pocket-marketing-pages</a> marketing pages for <a href="https://getpocket.com/" target="_blank" rel="noopener noreferrer">getpocket.com</a></li>
<li><a href="https://github.com/Pocket/apollo-utils" target="_blank" rel="noopener noreferrer">https://github.com/Pocket/apollo-utils</a> Utilities for Apollo gateway and implementing services</li>
<li><a href="https://github.com/Pocket/cloudwatch-metrics-aggregator" target="_blank" rel="noopener noreferrer">https://github.com/Pocket/cloudwatch-metrics-aggregator</a> nodejs lib to easily aggregate and process cloudwatch metrics in the background</li>
<li><a href="https://github.com/Pocket/curation-tools-frontend" target="_blank" rel="noopener noreferrer">https://github.com/Pocket/curation-tools-frontend</a></li>
<li><a href="https://github.com/Pocket/extension-pocket-new-tab" target="_blank" rel="noopener noreferrer">https://github.com/Pocket/extension-pocket-new-tab</a> Pocket New Tab is a browser extension that serves as a replacement to the default new tab.</li>
<li><a href="https://github.com/Pocket/extension-save-to-pocket" target="_blank" rel="noopener noreferrer">https://github.com/Pocket/extension-save-to-pocket</a> Save to Pocket is a browser extension that is used to save pages to a connected Pocket account</li>
<li><a href="https://github.com/Pocket/Firefox-Integration-Add-On-Prototype" target="_blank" rel="noopener noreferrer">https://github.com/Pocket/Firefox-Integration-Add-On-Prototype</a></li>
<li><a href="https://github.com/Pocket/front-end-build-tools" target="_blank" rel="noopener noreferrer">https://github.com/Pocket/front-end-build-tools</a> Modified Create React App for use with Pocket extensions</li>
<li><a href="https://github.com/Pocket/pocket-ff-addon" target="_blank" rel="noopener noreferrer">https://github.com/Pocket/pocket-ff-addon</a></li>
<li><a href="https://github.com/Pocket/proxy-server" target="_blank" rel="noopener noreferrer">https://github.com/Pocket/proxy-server</a> Service to deliver sponsored content while preserving privacy</li>
<li><a href="https://github.com/Pocket/recommendation-api" target="_blank" rel="noopener noreferrer">https://github.com/Pocket/recommendation-api</a> Rank and serve recommendations</li>
<li><a href="https://github.com/Pocket/pocket-ios" target="_blank" rel="noopener noreferrer">https://github.com/Pocket/pocket-ios</a> This appears to be the Pocket iOS app but there no is no README or description yet and it does not seem possible to build.</li>
<li><a href="https://github.com/Pocket/pocket-monorepo" target="_blank" rel="noopener noreferrer">https://github.com/Pocket/pocket-monorepo</a> "This repo contains all the Pocket Typescript systems built as a monorepo but deployed as microservices."</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="legal">Legal<a href="https://abdulrahim2002.github.io/open-pocket-docs/blog/genesis/#legal" class="hash-link" aria-label="Direct link to Legal" title="Direct link to Legal">​</a></h2>
<ul>
<li>Any open source code should follow Pocket's <a href="https://getpocket.com/developer/docs/branding" target="_blank" rel="noopener noreferrer">branding guidance</a>.</li>
<li>It is not yet known if Pocket/Mozilla hold any patents on Pocket behaviour.</li>
<li><a href="https://news.ycombinator.com/item?id=9520668" target="_blank" rel="noopener noreferrer">Pocket is a registered trademark</a></li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="background-1">Background<a href="https://abdulrahim2002.github.io/open-pocket-docs/blog/genesis/#background-1" class="hash-link" aria-label="Direct link to Background" title="Direct link to Background">​</a></h2>
<p>Open Pocket was founded by <a href="https://github.com/andyw8" target="_blank" rel="noopener noreferrer">@andyw8</a>. I was a long-term fan of Pocket. and a Premium subscriber from 2014 to 2023.
My favorite way to consume Pocket articles is with the Android app on a <a href="https://twitter.com/BoyueTechnology" target="_blank" rel="noopener noreferrer">Boyue Likebook</a> e-reader.
I'm also one of the maintainers of the <a href="https://github.com/turadg/pocket-ruby" target="_blank" rel="noopener noreferrer">pocket-ruby</a> API client.
For full transparency, I am also building a commercial product relating to Pocket (not yet released).</p>
<p>Update (2024): I'm no longer working on my own product since <a href="https://readwise.io/read" target="_blank" rel="noopener noreferrer">Readwise Reader</a> is a very promising successor to Pocket.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="related-and-similar-open-source-projects">Related and Similar Open Source Projects<a href="https://abdulrahim2002.github.io/open-pocket-docs/blog/genesis/#related-and-similar-open-source-projects" class="hash-link" aria-label="Direct link to Related and Similar Open Source Projects" title="Direct link to Related and Similar Open Source Projects">​</a></h2>
<ul>
<li><a href="https://github.com/omnivore-app/omnivore" target="_blank" rel="noopener noreferrer">https://github.com/omnivore-app/omnivore</a> (Node)<!-- -->
<ul>
<li>The company <a href="https://web.archive.org/web/20250428194155/https://blog.omnivore.app/p/details-on-omnivore-shutting-down" target="_blank" rel="noopener noreferrer">shut down after joining ElevenLabs</a> but the open source version is still active.</li>
</ul>
</li>
<li><a href="https://github.com/wallabag/wallabag" target="_blank" rel="noopener noreferrer">https://github.com/wallabag/wallabag</a> (PHP) (formerly known as Poche)</li>
<li><a href="https://github.com/ArchiveBox/ArchiveBox" target="_blank" rel="noopener noreferrer">https://github.com/ArchiveBox/ArchiveBox</a> (Python)</li>
<li><a href="https://github.com/go-shiori/shiori" target="_blank" rel="noopener noreferrer">https://github.com/go-shiori/shiori</a> (Go)</li>
<li><del><a href="https://github.com/burtonator/polar-bookshelf" target="_blank" rel="noopener noreferrer">https://github.com/burtonator/polar-bookshelf</a> (last updated in 2021)</del></li>
<li><a href="https://github.com/cleverdevil/indiepaper" target="_blank" rel="noopener noreferrer">https://github.com/cleverdevil/indiepaper</a> (Python) (last updated in 2018)</li>
<li><a href="https://github.com/zhy0216/OhMyPocket" target="_blank" rel="noopener noreferrer">https://github.com/zhy0216/OhMyPocket</a> (Python) (last updated in 2016)</li>
<li><a href="https://github.com/kavinderd/icebox" target="_blank" rel="noopener noreferrer">https://github.com/kavinderd/icebox</a> (Ruby) (last updated since 2015)</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="related-and-similar-commercial-products">Related and Similar Commercial Products<a href="https://abdulrahim2002.github.io/open-pocket-docs/blog/genesis/#related-and-similar-commercial-products" class="hash-link" aria-label="Direct link to Related and Similar Commercial Products" title="Direct link to Related and Similar Commercial Products">​</a></h2>
<ul>
<li><a href="https://readwise.io/read" target="_blank" rel="noopener noreferrer">Readwise Reader</a> (<a href="https://blog.readwise.io/the-next-chapter-of-reader-public-beta/" target="_blank" rel="noopener noreferrer">announcement blog post</a>)</li>
</ul>]]></content>
        <author>
            <name>Open Pocket Team</name>
        </author>
        <category label="OpenPocket" term="OpenPocket"/>
    </entry>
</feed>